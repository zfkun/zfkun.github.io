<!DOCTYPE HTML>
<!--[if lt IE 7]><html class="ie6"><![endif]-->
<!--[if IE 7]><html class="ie7"><![endif]-->
<!--[if IE 8]><html class="ie8"><![endif]-->
<!--[if gt IE 8]><html><![endif]-->
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<title>7K7K - 开放平台 - qksdk测试 - 好友邀请</title>
	<style type="text/css">
	.green {color: green;} .red {color: red;} .blue {color: blue;}
	#logMod {border:1px solid gray;padding:10px;width:580px;height:200px;overflow-y:auto;overflow-x:hidden;}
	#logMod p {padding: 0; margin: 5px 0;font-size: 14px;}
	</style>
	<script>
	function getQuery(q, s) {
		return (v = (s || location).search.match(new RegExp("[\?\&]" + q + "=([^\&]*)(\&?)","i"))) ? v[1] : v;
	}
	var appid = getQuery('appid') || 10000, platform = getQuery('platform');
	</script>
</head>
<body>
	<form id="apiForm" action="./" onsubmit="return false;">
		<label for="apiAppId">appid: </label>
		<input id="apiAppId" name="appid" title="DEMO暂不支持修改" value="" size="10" readOnly="readOnly"/>

		<label for="apiPlatform">platform: </label>
		<select id="apiPlatform" name="platform">
			<option value="">---请选择平台---</option>
			<option value="open">通用</option>
			<option value="my">社区</option>
		</select>

		<br/><br/>
		<label for="apiList">api: </label>
		<select id="apiList" name="api">
			<option value="">---请选择API---</option>
		</select>
		
		<label for="apiData">data: </label>
		<input id="apiData" name="data" placeholder="请输入 api data ..." value="" size="60" />

		<button type="submit" name="submit">执行</button>

		<br/><br/>
		<label for="apiEventResize">resize: </label>
		<input type="checkbox" name="apiEvent" value="resize" id="apiEventResize">
		&nbsp;&nbsp;
		<label for="apiEventLoad">load: </label>
		<input type="checkbox" name="apiEvent" value="load" id="apiEventLoad">
		&nbsp;&nbsp;
		<label for="apiEventFrameload">frameload: </label>
		<input type="checkbox" name="apiEvent" value="frameload" id="apiEventFrameload">
		&nbsp;&nbsp;
		<label for="apiEventShown">shown: </label>
		<input type="checkbox" name="apiEvent" value="shown" id="apiEventShown">
		&nbsp;&nbsp;
		<label for="apiEventClose">close: </label>
		<input type="checkbox" name="apiEvent" value="close" id="apiEventClose">
		<br/>
		<label for="apiEventSubmit">submit: </label>
		<input type="checkbox" name="apiEvent" value="submit" id="apiEventSubmit">
		&nbsp;&nbsp;
		<label for="apiEventCancel">cancel: </label>
		<input type="checkbox" name="apiEvent" value="cancel" id="apiEventCancel">
		&nbsp;&nbsp;
		<label for="apiEventSuccess">success: </label>
		<input type="checkbox" name="apiEvent" value="success" id="apiEventSuccess">
		&nbsp;&nbsp;
		<label for="apiEventError">error: </label>
		<input type="checkbox" name="apiEvent" value="error" id="apiEventError">
	</form>

	<br/>
	<!-- <textarea name="logMod" id="logMod" cols="100" rows="15"></textarea> -->
	<div id="logMod"></div>


<script src="https://a.tbcdn.cn/s/kissy/1.2.0/kissy-min.js"></script>
<script>
	KISSY.ready(function(S) {
		var $ = S.one, $$ = S.all, JSON = S.JSON, locker = {};

		function log(a, b, c) {
			if (!locker[b]) $('#logMod').html($('#logMod').html() + '<p><span class="green">[Debug]</span> <span class="red">&lt;' + a + '&gt;</span> <span class="blue">(' + b + ')</span>: ' + c + "</p>");
		}


		// test data
		var dataSource = {
			// 'dialog.inviteDev': {
			// 	context: '',
			// 	//img: 'App预览LOGO地址URL',
			// 	msg: '测试信息内容，支持HTML',
			// 	onResize: !window.ActiveXObject ? function(data) {
			// 		log('dialog.inviteDev', 'resize', JSON.stringify(data));
			// 	} : function() {},
			// 	onShown: function(data) {
			// 		log('dialog.inviteDev', 'shown', JSON.stringify(data));
			// 	},
			// 	onCancel: function(data) {
			// 		log('dialog.inviteDev', 'cancel', JSON.stringify(data));
			// 	},
			// 	onClose: function(data) {
			// 		log('dialog.inviteDev', 'close', JSON.stringify(data));
			// 	},
			// 	onError: function(data) {
			// 		log('dialog.inviteDev', 'error', JSON.stringify(data));
			// 	},
			// 	onSuccess: function(data) {
			// 		log('dialog.inviteDev', 'success', JSON.stringify(data));
			// 	},
			// 	onLoad: function(data) {
			// 		log('dialog.inviteDev', 'load', JSON.stringify(data));
			// 	},
			// 	onFrameLoad: function(data) {
			// 		log('dialog.inviteDev', 'frameload', JSON.stringify(data));
			// 	},
			// 	onSubmit: function(data) {
			// 		log('dialog.inviteDev', 'submit', JSON.stringify(data));
			// 	}
			// },
			'dialog.invite': {
				context: '',
				img: 'https://simg.7k7kimg.cn/hgame_icons/11/51/51024e3d62fb6fa677a8bb386fb961b5_s.jpg?1343273047',
				msg: '《我的王国》是以欧洲中世纪为背景的',
				onResize: !window.ActiveXObject ? function(data) {
					log('dialog.invite', 'resize', JSON.stringify(data));
				} : function() {},
				onShown: function(data) {
					log('dialog.invite', 'shown', JSON.stringify(data));
				},
				onCancel: function(data) {
					log('dialog.invite', 'cancel', JSON.stringify(data));
				},
				onClose: function(data) {
					log('dialog.invite', 'close', JSON.stringify(data));
				},
				onError: function(data) {
					log('dialog.invite', 'error', JSON.stringify(data));
				},
				onSuccess: function(data) {
					log('dialog.invite', 'success', JSON.stringify(data));
				},
				onLoad: function(data) {
					log('dialog.invite', 'load', JSON.stringify(data));
				},
				onFrameLoad: function(data) {
					log('dialog.invite', 'frameload', JSON.stringify(data));
				},
				onSubmit: function(data) {
					log('dialog.invite', 'submit', JSON.stringify(data));
				}
			},
			'dialog.login': {
				context: '',
				onResize: !window.ActiveXObject ? function(data) {
					log('dialog.login', 'resize', JSON.stringify(data));
				} : function() {},
				onShown: function(data) {
					log('dialog.login', 'shown', JSON.stringify(data));
				},
				onCancel: function(data) {
					log('dialog.login', 'cancel', JSON.stringify(data));
				},
				onClose: function(data) {
					log('dialog.login', 'close', JSON.stringify(data));
				},
				onError: function(data) {
					log('dialog.login', 'error', JSON.stringify(data));
				},
				onSuccess: function(data) {
					log('dialog.login', 'success', JSON.stringify(data));
				},
				onLoad: function(data) {
					log('dialog.login', 'load', JSON.stringify(data));
				},
				onFrameLoad: function(data) {
					log('dialog.login', 'frameload', JSON.stringify(data));
				},
				onSubmit: function(data) {
					log('dialog.login', 'submit', JSON.stringify(data));
				}
			},
			'dialog.performance': {

			}
		};


		$('#apiForm').on('submit', function(ev) {
			var api = this.elements['api'].value,
				data = this.elements['data'].value;

			if (!(api in dataSource)) return;

			try {
				data = JSON.parse(data);
			} catch(e) {}

			data = data || dataSource[api];

			log('call', api, JSON.stringify(data));

			if (api === 'dialog.inviteDev') {
				qksdk.dialog.inviteDev(data);
			} else if (api === 'dialog.invite') {
				qksdk.dialog.invite(data);
			} else if (api === 'dialog.login') {
				qksdk.dialog.login(data);
			} else if (api === 'dialog.performance') {
				qksdk.dialog.performance(data);
			}
		});


		// setup
		$('#apiAppId').val(appid).prop('disabled', true);
		if (appid && platform) {
			//$('#apiAppId').val(appid).prop('disabled', true);
			$('#apiPlatform').val(platform).prop('disabled', true);
			
			for (var api in dataSource) {
				$('#apiList')[0].options.add(new Option(api, api));
			}

			$$($('#apiForm')[0].elements['apiEvent']).each(function(node){
				node[0].checked = node[0].value === 'resize' ? false : true;
				locker[node[0].value] = !!!node[0].checked;
			}).on('click', function(ev){
				locker[ev.target.value] = !!!ev.target.checked;
			});
			
			S.getScript('https://api.open.7k7k.com/open/sdk/loader.php?appid=' + appid + '&platform=' + platform);

		} else {
			$('#apiPlatform').on('change', function(ev) {
				var aid = $('#apiAppId').val(), val = $(this).val();
				if (val == 'open') {
					location.href = location.href + '?appid=' + aid + '&platform=' + val;
				} else {
					alert('时间有限，仅支持 "appid: ' + aid + '" 的 "通用平台" 测试');
					return false;
				}
			});
		}

	});
</script>


</body>
</html>
