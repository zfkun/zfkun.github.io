<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
<title>window.open() 句柄保持及重连 - Child Window | Demo演示 | 影の域</title>
<style type="text/css" src="/static/css/reset-min.css"></style>
<style type="text/css">
body {font-size: 18px;}
.adsense {text-align:center;}
</style>
<script type="text/javascript">//document.domain = 'zfkun.com';</script>
</head>
<body>

<div style="text-align:center;">
	<h1>Child Window</h1>
	<textarea id="loger" cols="90" rows="15"></textarea>
</div>

<script type="text/javascript">
var originOpenerUrl = window.opener.location.href,
	timer,
	OPENER_STATUS = -1; // 0: alive, 1: closed, 2: leaved 

function doFocus() {
	window.focus();
}
function doReconnect() {
	OPENER_STATUS = 0;
	doLog('reconnected at ' + (+new Date));
}
function doWatch() {
    if (window.opener && window.opener.closed) {
    	if (OPENER_STATUS !== 1) {
    		OPENER_STATUS = 1;
        	doLog('origin opener has closed');
    	}
    } else {
    	var url;
    	try {
    		url = window.opener.location.href;
    	} catch(e) {
    		if (OPENER_STATUS !== 2) {
    			OPENER_STATUS = 2;
    			doLog("origin opener has leave to other page (crossdoamin)");
    		}
    	}
    	
        if (originOpenerUrl !== url) {
        	if (OPENER_STATUS !== 2) {
        		OPENER_STATUS = 2;
        		doLog("origin opener has leaved, at page: " + url);
        	}
        } else {
        	if (OPENER_STATUS !== 0) {
        		OPENER_STATUS = 0;
        		doLog("current opener at the origin page: \n&nbsp;&nbsp;" + originOpenerUrl);
        	}
        }
        
    }
}

function doLog(msg) { document.getElementById('loger').value += msg + "\n"; }

timer = setInterval(doWatch, 2000);
</script>

<div class="adsense">
<script type="text/javascript"><!--
google_ad_client = "ca-pub-2950544153986345";
google_ad_slot = "4341512254";
google_ad_width = 728;
google_ad_height = 15;
//-->
</script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script>
</div>

<script type="text/javascript" src="/static/stat.js"></script>
</body>
</html>